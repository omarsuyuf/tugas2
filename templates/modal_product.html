<div id="product-modal-backdrop" class="fixed inset-0 bg-black/60 hidden"></div>

<div id="product-modal" class="fixed inset-0 hidden items-center justify-center p-4">
  <div class="bg-neutral-900 text-gray-100 rounded-xl w-full max-w-lg shadow-2xl border border-neutral-800">
    <div class="px-5 py-4 border-b border-neutral-800 flex items-center justify-between">
      <h3 class="text-lg font-semibold">Create Product</h3>
      <button type="button" class="text-gray-400 hover:text-gray-200" data-close-modal>&times;</button>
    </div>

    <form id="productForm" class="p-5 space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-300">Name</label>
        <input name="name" required
               class="mt-1 w-full rounded-md px-3 py-2 bg-neutral-800 border border-neutral-700 focus:border-green-500 focus:outline-none text-gray-100 placeholder-neutral-400"
               placeholder="e.g. Bola Latihan">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">Price</label>
        <input name="price" type="number" min="0" step="1" value="0"
               class="mt-1 w-full rounded-md px-3 py-2 bg-neutral-800 border border-neutral-700 focus:border-green-500 focus:outline-none text-gray-100 placeholder-neutral-400">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">Category</label>
        <select name="category"
                class="mt-1 w-full rounded-md px-3 py-2 bg-neutral-800 border border-neutral-700 focus:border-green-500 focus:outline-none text-gray-100">
          <option value="ball">Ball</option>
          <option value="boots">Boots</option>
          <option value="jersey">Jersey</option>
          <option value="accessory">Accessory</option>
          <option value="kit">Kit</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">Thumbnail (URL)</label>
        <input name="thumbnail"
               class="mt-1 w-full rounded-md px-3 py-2 bg-neutral-800 border border-neutral-700 focus:border-green-500 focus:outline-none text-gray-100 placeholder-neutral-400"
               placeholder="https://...">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-300">Description</label>
        <textarea name="description" rows="3"
                  class="mt-1 w-full rounded-md px-3 py-2 bg-neutral-800 border border-neutral-700 focus:border-green-500 focus:outline-none text-gray-100 placeholder-neutral-400"
                  placeholder="Short description..."></textarea>
      </div>

      <label class="inline-flex items-center gap-2 select-none">
        <input type="checkbox" name="is_featured" class="border rounded bg-neutral-800 border-neutral-700">
        <span class="text-sm text-gray-300">Featured</span>
      </label>

      <div class="pt-2 flex items-center justify-end gap-3">
        <button type="button"
                class="px-4 py-2 rounded-md border border-neutral-700 bg-neutral-800 text-gray-100 hover:bg-neutral-700"
                data-close-modal>Cancel</button>
        <button type="submit"
                class="px-4 py-2 rounded-md bg-green-600 text-white hover:bg-green-700">Create</button>
      </div>
    </form>
  </div>
</div>

<script>
  const CREATE_PRODUCT_ENDPOINT = "{% url 'main:add_product_entry_ajax' %}";

  function openProductModal(){
    document.getElementById('product-modal').classList.remove('hidden');
    document.getElementById('product-modal').classList.add('flex');
    document.getElementById('product-modal-backdrop').classList.remove('hidden');
  }
  function closeProductModal(){
    document.getElementById('product-modal').classList.add('hidden');
    document.getElementById('product-modal').classList.remove('flex');
    document.getElementById('product-modal-backdrop').classList.add('hidden');
  }

  document.getElementById('btn-open-create')?.addEventListener('click', (e)=>{
    e.preventDefault();
    openProductModal();
  });

  document.querySelectorAll('[data-close-modal]').forEach(btn=>{
    btn.addEventListener('click', e=>{ e.preventDefault(); closeProductModal(); });
  });

  document.getElementById('productForm').addEventListener('submit', async (e)=>{
    e.preventDefault();
    const fd = new FormData(document.getElementById('productForm'));

    const res = await fetch(CREATE_PRODUCT_ENDPOINT, { method: 'POST', body: fd });
    if (!res.ok) {
      (window.showToast ? showToast('Failed to add product', '', 'error') : alert('Failed to add product'));
      return;
    }

    document.getElementById('productForm').reset();
    closeProductModal();
    (window.showToast ? showToast('Product added!', '', 'success') : console.log('Product added'));
    document.dispatchEvent(new CustomEvent('productAdded'));
  });
</script>
